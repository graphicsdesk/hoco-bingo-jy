<div class="bingo-embed">
  <style>
    .bingo-embed {
      --cell-size: min(12vmin, 120px);
      --gap: 10px;
      --blue-checked: #B9D9EB;
      --cell-bg: #fff;
      --cell-border: #d6d6d6;
      --font-family: Roboto, Helvetica, Arial, sans-serif;
      font-family: var(--font-family);
      width: 100%;
      max-width: 820px;
      margin: 0 auto;
      background-color: white !important;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    .bingo-embed p {
      margin: 0 0 12px 0;
      text-align: center;
      color: #444;
    }

    .bingo-embed .board {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: var(--gap);
      width: 100%;
      max-width: 100%;
      padding: 1rem;
      background-color: #B9D9EB;
      border-radius: 10px;
      box-sizing: border-box;
      justify-items: center;
    }

    .bingo-embed .cell {
      background-color: white;
      color: black;
      aspect-ratio: 1 / 1;
      width: 100%;
      background: var(--cell-bg);
      border: 2px solid white;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0.4rem;
      box-sizing: border-box;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      transition: background 180ms ease, transform 120ms ease, box-shadow 120ms ease;
      font-size: 1rem;
      line-height: 1.1;
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.03);
      overflow: hidden;
      word-wrap: break-word;
    }

    .bingo-embed .cell:active {
      transform: translateY(1px);
    }

    .bingo-embed .cell.checked {
      background: #1D4F91;
      color: white;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.06);
    }

    .bingo-embed .cell.free {
      background: linear-gradient(180deg, #fff 0%, #f2f7ff 100%);
      border-style: dashed;
      color: #333;
      font-weight: 600;
    }

    .bingo-embed .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 10px;
    }

    .bingo-embed .btn {
      background: #0b2b36;
      color: #fff;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .bingo-embed .btn.ghost {
      background: transparent;
      color: #0b2b36;
      border: 2px solid #d6d6d6;
    }

    @media (max-width: 600px) {
      .bingo-embed .board {
        gap: 6px;
        padding: 8px;
      }

      .bingo-embed .cell {
        width: clamp(50px, 18vw, 100px);
      }
    }

    @media (max-width: 480px) {
      .bingo-embed {
        --gap: 5px;
      }

      .bingo-embed .board {
        padding: 6px;
      }

      .bingo-embed .cell {
        font-size: 0.6rem;
        padding: 0.2rem;
        border-radius: 6px;
        width: 100%;
      }
    }
  </style>

  <p>Click on the tasks if you've completed them!</p>

  <div id="bingo-board" class="board" aria-label="Homecoming bingo board"></div>

  <div class="controls">
    <button id="bingo-reset" class="btn ghost" title="Clear all marks">Reset</button>
  </div>

  <script>
    (function () {
      const items = [
        "“Roar, Lion, Roar” getting its moment to shine",
        "Running into at least one drunk parent at a darty",
        "Missed the shuttle you planned on taking to the stadium",
        "Forgot ID, or never made it inside the stadium",
        "Wore the closest colour you had to Columbia Blue - your only piece of columbia merch",
        "Wished you had brought a jacket",
        "Thought this outfit is too cute for a jacket",
        "Actually understood what was happening in the game",
        "Stayed past halftime",
        "Thought homecoming meant a campus wide dance",
        "Skipped the game, opted for bottomless brunch instead",
        "Got a pantone 290 C stamped onto your face, regretted it right after",
        "BORG-ed too close to the sun",
        "Spent most of the day on frat row",
        "Sipped on jungle juice, at said frat darty",
        "Taken a picture with Roar-ee",
        "Had to go back home at 1 p.m., due to 'unforeseen circumstances’",
        "Communal Nap, no it is not a bacchanal specific phenomenon",
        "Had to explain what homecoming is to your family, visiting for family weekend",
        "Only gone to the stadium to watch the half time show",
        "Cheered from the bleachers, never knowing what for",
        "Threw up on the 1 train back home",
        "Bought a foam finger",
        "Tried to understand the game, gave up midway through"
      ];

      const STORAGE_KEY = "homecoming_bingo_state_v1";
      const boardEl = document.getElementById("bingo-board");

      function loadState() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) && parsed.length === 25 ? parsed : Array(25).fill(false);
        } catch {
          return Array(25).fill(false);
        }
      }

      function saveState(state) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      const state = loadState();
      let itemIndex = 0;

      for (let i = 0; i < 25; i++) {
        const cell = document.createElement("button");
        cell.className = "cell";
        cell.type = "button";
        cell.setAttribute("data-index", i);
        cell.setAttribute("aria-pressed", "false");

        if (i === 12) {
          cell.classList.add("free");
          cell.id = "bingo-free-cell";
          cell.innerHTML = "<div style='font-size:0.9rem'>FREE<br></div>";
          cell.addEventListener("click", () => {
            cell.animate([{ transform: "scale(1)" }, { transform: "scale(0.98)" }, { transform: "scale(1)" }], { duration: 160 });
          });
          state[i] = false;
        } else {
          const text = items[itemIndex++] || "";
          cell.innerHTML = `<span class="label">${escapeHtml(text)}</span>`;
          if (state[i]) {
            cell.classList.add("checked");
            cell.setAttribute("aria-pressed", "true");
          }
          cell.addEventListener("click", () => {
            const idx = Number(cell.getAttribute("data-index"));
            const checked = cell.classList.toggle("checked");
            cell.setAttribute("aria-pressed", checked ? "true" : "false");
            state[idx] = checked;
            saveState(state);
          });
        }

        boardEl.appendChild(cell);
      }

      document.getElementById("bingo-reset").addEventListener("click", () => {
        for (let i = 0; i < 25; i++) {
          if (i === 12) continue;
          const btn = boardEl.querySelector(`[data-index="${i}"]`);
          if (btn) {
            btn.classList.remove("checked");
            btn.setAttribute("aria-pressed", "false");
          }
          state[i] = false;
        }
        saveState(state);
      });

      function escapeHtml(s) {
        return s
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;");
      }

      // Resize text dynamically
      function resizeAllText() {
        const cells = document.querySelectorAll(".bingo-embed .cell:not(.free)");
        let minSize = Infinity;
        cells.forEach(cell => {
          const span = cell.querySelector(".label");
          if (!span) return;
          span.style.fontSize = "16px";
          const boxHeight = cell.clientHeight - 8;
          const boxWidth = cell.clientWidth - 8;
          let size = 16;
          while ((span.scrollHeight > boxHeight || span.scrollWidth > boxWidth) && size > 8) {
            size -= 0.5;
            span.style.fontSize = size + "px";
          }
          if (size < minSize) minSize = size;
        });
        cells.forEach(cell => {
          const span = cell.querySelector(".label");
          if (span) span.style.fontSize = minSize + "px";
        });
      }

      window.addEventListener("load", resizeAllText);
      window.addEventListener("resize", resizeAllText);
    })();
  </script>
</div>
